Changes only in Hortonworks github and not in Apache SPARK-2.2.0 and hence not covered by CHANGES.txt.

INCOMPATIBLE CHANGES

NEW FEATURES
    RMP-7559. Support virtualenv in PySpark (SPARK-13587)

    (Apache ORC)
    RMP-8827     ORC, Vectorization and Perf Improvements
    BUG-88481    Add spark.sql.orc.char.enabled
    SPARK-14387  Enable Hive-1.x ORC compatibility with spark.sql.hive.convertMetastoreOrc
    SPARK-16060  Vectorized Orc Reader
    SPARK-16628  OrcConversions should not convert an ORC table represented by MetastoreRelation to HadoopFsRelation if metastore schema does not match schema stored in ORC files
    SPARK-18355  Spark SQL fails to read data from a ORC hive table that has a new column added to it
    SPARK-19809* NullPointerException on empty ORC file
    SPARK-20682  Support a new faster ORC data source based on Apache ORC
    SPARK-20728  Make ORCFileFormat configurable between sql/hive and sql/core
    SPARK-21422  Depend on Apache ORC 1.4.0
    SPARK-21477  Mark LocalTableScanExec's input data transient
    SPARK-21791* ORC should support column names with dot
    SPARK-21787* Support for pushing down filters for date types in ORC
    SPARK-21831  Remove `spark.sql.hive.convertMetastoreOrc` config in HiveCompatibilitySuite
    SPARK-21912  ORC/Parquet table should not create invalid column names
    SPARK-21929  Support `ALTER TABLE table_name ADD COLUMNS(..)` for ORC data source
    SPARK-22146  FileNotFoundException while reading ORC files containing special characters
    SPARK-22158  convertMetastore should not ignore table property
    SPARK-22300  Update ORC to 1.4.1

    Note that '*' denotes a feature supported only with new ORC file formats.

IMPROVEMENTS
    RMP-6461: Add --jarDirs and SPARK_APP_JARS to include directories in spark-submit and spark-shell
    RMP-6448: hdp.version
    RMP-6954: SparkSQL Ranger integration for fine grained access control in Spark 2.1
    BUG-62302 Support HiveServer2 delegation token acquisition in Spark
    BUG-70581 Add hadoop-3.0 profile
    RMP-9454  Update the LLAP for Spark2.2 (SparkSQL Ranger integration for fine grained access control in Spark 2.2)

BUG FIXES
    BUG-73561   Virtualenv example fails in yarn-cluster mode with requirement.txt not found error
    BUG-58486   Use cache file created by ambari as spark.yarn.archive
    BUG-48982   Add hadoop lzo jar to the classpath
    BUG-52253   Support configuring YARN correctly for multiple Spark versions and their aux-services
    BUG-60289   Spark2 jersey and Timeline Jersey are incompatible
    BUG-59418   changes to KafkaRDD MessageAndMetadata to use named params
    BUG-61726   SparkLauncherSuite unit test failing
    BUG-63858   S3CountLines application fails in yarn-cluster mode: user should not call system.exit(0) terminate the application in spark 2
    BUG-68592   Implement `spark-llap2` package for Spark 2.1.x
    BUG-71525   Support `spark.sql.hive.llap` configuration
    SPARK-207   Remove hardcode FS scheme from Spark archive
    BUG-77149   Spark2 build failure in atlantic because [SPARK-17979] SPARK_YARN_USER_ENV and SPARK_JAVA_OPTS depreciated.
    BUG-79168   Spark2 compilation failure because (1)LLAP related patches are missing (2) conflict between hdp-master and Apache/master in the Client.scala
    BUG-77776   Fix STS error handling logic on HiveSQLException
    BUG-81926   Issue with inserting data from Spark SQL using hivecontext
    BUG-77400   Fix HiveServer2 delegation token acquisition
    BUG-84597   Fix VersionsSuite failures
    BUG-86685   Fix SparkLauncherSuite.testChildProcLauncher
    BUG-90501   Fix spark.sql.hive.caseSensitiveInferenceMode to NEVER_INFER
    BUG-85326   spark-llap: Notify Hive on Spark query completions
    BUG-90803   Added hadoop-azure-datalake and azure-data-lake-store-sdk to all the wasb locations

    (Backport from 2.2.1)
    SPARK-21663   test("remote fetch below max RPC message size") should call masterTracker.stop() in MapOutputTrackerSuite
    SPARK-21596   Ensure places calling HDFSMetadataLog.get check the return value
    SPARK-21523   update breeze to 0.13.2 for an emergency bugfix in strong wolfe line search
    SPARK-21503   Spark UI shows incorrect task status for a killed Executor Process
    SPARK-21648   Fix confusing assert failure in JDBC source when parallel fetching parameters are not properly provided.
    SPARK-21565   Propagate metadata in attribute replacement.
    SPARK-21374   Fix reading globbed paths from S3 into DF with disabled FS cache
    SPARK-21647   Fix SortMergeJoin when using CROSS
    SPARK-21621   Reset numRecordsWritten after DiskBlockObjectWriter.commitAndGet called
    SPARK-21588   SQLContext.getConf(key, null) should return null
    SPARK-21580   Integers in aggregation expressions are wrongly taken as group-by ordinal
    SPARK-21330   Bad partitioning does not allow to read a JDBC table with extreme values on the partition column
    Fix Java SimpleApp spark application
    SPARK-12717   Adding thread-safe broadcast pickle registry
    SPARK-21546   dropDuplicates should ignore watermark when it's not a key
    SPARK-21597   Fix a potential overflow issue in EventTimeStats
    SPARK-21339   spark-shell --packages option does not add jars to classpath on windows
    SPARK-21593   Fix 2 rendering errors on configuration page
    SPARK-21522   Fix flakiness in LauncherServerSuite.
    SPARK-21555   RuntimeReplaceable should be compared semantically by its canonicalized child
    SPARK-21508   Fix example code provided in Spark Streaming Documentation
    SPARK-21306   OneVsRest should support setWeightCol
    SPARK-21538   Attribute resolution inconsistency in the Dataset API
    SPARK-21494   Use correct app id when authenticating to external service.
    SPARK-21447   Spark history server fails to render compressed
    SPARK-21383   Fix the YarnAllocator allocates more Resource
    SPARK-20904   Don't report task failures to driver during shutdown.
    SPARK-21434   Add pyspark pip documentation.
    SPARK-21243   Limit no. of map outputs in a shuffle fetch
    SPARK-21333   Removed invalid joinTypes from javadoc of Dataset#joinWith
    SPARK-21446   Fix setAutoCommit never executed
    SPARK-21464   Minimize deprecation warnings caused by ProcessingTime class
    SPARK-21441   Incorrect Codegen in SortMergeJoinExec results failures in some cases
    SPARK-21414   Refine SlidingWindowFunctionFrame to avoid OOM.
    SPARK-21457   ExternalCatalog.listPartitions should correctly handle partition values with dot
    SPARK-21445   Make IntWrapper and LongWrapper in UTF8String Serializable
    SPARK-21332   Incorrect result type inferred for some decimal expressions
    SPARK-21321   Spark very verbose on shutdown
    SPARK-21267   Follow up to avoid referencing programming-guide redirector
    SPARK-21344   BinaryType comparison does signed byte array comparison
    SPARK-21376   Fix yarn client token expire issue when cleaning the staging files in long running scenario
    SPARK-21219   Task retry occurs on same executor due to race co…
    SPARK-21366   Add sql test for window functions
    SPARK-21369   Don't use Scala Tuple2 in common/network-*
    SPARK-21272   SortMergeJoin LeftAnti does not update numOutputRows
    SPARK-21342   Fix DownloadCallback to work well with RetryingBlockFetcher.
    SPARK-21083   Store zero size and row count when analyzing empty table
    SPARK-21343   Refine the document for spark.reducer.maxReqSizeShuffleToMem.
    SPARK-20342   Update task accumulators before sending task end event.
    SPARK-21345   SparkSessionBuilderSuite should clean up stopped sessions.
    SPARK-21228   InSet incorrect handling of structs
    SPARK-21069   Add rate source to programming guide.
    SPARK-21267   Update Structured Streaming Documentation
    MINOR         Fix flaky test in DatastreamReaderWriterSuite. temp checkpoint dir should be deleted
    SPARK-21312   correct offsetInBytes in UnsafeRow.writeToStream
    SPARK-21300   ExternalMapToCatalyst should null-check map key prior to converting to internal value.
    SPARK-20256   SessionState should be created more lazily
    SPARK-21170   Utils.tryWithSafeFinallyAndFailureCallbacks throws IllegalArgumentException: Self-suppression not permitted
    SPARK-21699   Remove unused getTableOption in ExternalCatalog
    SPARK-21595   Separate thresholds for buffering and spilling in ExternalAppendOnlyUnsafeRowArray
    SPARK-21563   Fix race condition when serializing TaskDescriptions and adding jars
    SPARK-21696   Fix a potential issue that may generate partial snapshot files
    SPARK-21721   Clear FileSystem deleteOnExit cache when paths are successfully removed
    SPARK-21723   Fix writing LibSVM (key not found: numFeatures)
    SPARK-21656   spark dynamic allocation should not idle timeout executors when tasks still to run
    SPARK-18464   support old table which doesn't store schema in table properties
    SPARK-21739   Cast expression should initialize timezoneId when it is called statically to convert something into TimestampType
    SPARK-21721   Clear FileSystem deleteOnExit cache when paths are successfully removed
    SPARK-21617   Store correct table metadata when altering schema in Hive metastore.
    SPARK-21805   Disable R vignettes code on Windows
    SPARK-21826   outer broadcast hash join should not throw NPE
    SPARK-21681   fix bug of MLOR do not work correctly when featureStd contains zero (backport PR for 2.2)
    SPARK-21818   Fix bug of MultivariateOnlineSummarizer.variance generate negative result
    SPARK-21798   No config to replace deprecated SPARK_CLASSPATH config for launching daemons like History Server
    SPARK-21714   Avoiding re-uploading remote resources in yarn client mode
    SPARK-21254   History UI performance fixes
    SPARK-21834   Incorrect executor request in case of dynamic allocation
    SPARK-21418   NoSuchElementException: None.get in DataSourceScanExec with sun.io.serialization.extendedDebugInfo=true
    SPARK-21925   Update trigger interval documentation in docs with behavior change in Spark 2.2
    SPARK-21924   Update structured streaming programming guide doc
    SPARK-21901   Define toString for StateOperatorProgress
    SPARK-21890   Credentials not being passed to add the tokens
    SPARK-21128   Remove both "spark-warehouse" and "metastore_db" before listing files in R tests
    SPARK-21946   fix flaky test: "alter table: rename cached table" in InMemoryCatalogedDDLSuite
    SPARK-21936   backward compatibility test framework for HiveExternalCatalog
    SPARK-21915   Model 1 and Model 2 ParamMaps Missing
    SPARK-21950   pyspark.sql.tests.SQLTests2 should stop SparkContext.
    SPARK-21954   JacksonUtils should verify MapType's value type instead of key type
    SPARK-20098   dataType's typeName fix
    SPARK-21976   Fix wrong documentation for Mean Absolute Error.
    SPARK-18608   Fix double caching
    SPARK-21980   References in grouping functions should be indexed with semanticEquals
    SPARK-18608   Fix double caching for PySpark OneVsRest.
    SPARK-21985   PairDeserializer is broken for double-zipped RDDs
    SPARK-21953   Show both memory and disk bytes spilled if either is present
    SPARK-22043   Improves error message for show_profiles and dump_profiles
    SPARK-22047   ignore HiveExternalCatalogVersionsSuite
    SPARK-22047   HiveExternalCatalogVersionsSuite
    SPARK-22052   Incorrect Metric assigned in MetricsReporter.scala
    SPARK-22076   Expand.projections should not be a Stream
    SPARK-21384   Spark + YARN fails with LocalFileSystem as default FS
    SPARK-21928   Set classloader on SerializerManager's private kryo
    SPARK-22094   processAllAvailable should check the query state
    SPARK-22072   Improve release build scripts
    SPARK-18136   Fix SPARK_JARS_DIR for Python pip install on Windows
    SPARK-22092   Reallocation in OffHeapColumnVector.reserveInternal corrupts struct and array data
    SPARK-22109   Resolves type conflicts between strings and timestamps in partition column
    SPARK-22107   Change as to alias in python quickstart
    SPARK-22083   Release locks in MemoryStore.evictBlocksToFreeSpace
    SPARK-22120   TestHiveSparkSession.reset() should clean out Hive warehouse directory
    SPARK-22141   Propagate empty relation before checking Cartesian products
    SPARK-22140   Add TPCDSQuerySuite
    SPARK-22135   metrics in spark-dispatcher not being registered properly
    SPARK-22143   Fix memory leak in OffHeapColumnVector
    SPARK-22129   Release script improvements
    SPARK-22161   Add Impala-modified TPC-DS queries
    SPARK-22167   sparkr packaging issue allow zinc
    SPARK-22178   Refresh Persistent Views by REFRESH TABLE Command
    SPARK-20466   HadoopRDD#addLocalConfiguration throws NPE
    SPARK-22206   gapply in R can't work on empty grouping columns
    SPARK-21549   Respect OutputFormats with no output directory provided
    SPARK-22218   spark shuffle services fails to update secret on app re-attempts
    SPARK-21907   NullPointerException in UnsafeExternalSorter.spill()
    SPARK-22252   FileFormatWriter should respect the input query schema
    SPARK-22273   Fix key/value schema field names in HashMapGenerators.
    SPARK-22223   ObjectHashAggregate should not introduce unnecessary shuffle
    SPARK-22271   mean overflows and returns null for some decimal variables
    SPARK-21551   Increase timeout for PythonRDD.serveIterator
    SPARK-17920   Support writing to Hive table which uses Avro schema url 'avro.schema.url'
    SPARK-19580   Support for avro.schema.url while writing to hive table
    SPARK-19878   Add hive configuration when initialize hive serde in InsertIntoHiveTable.scala
    SPARK-22249   isin with empty list throws exception on cached DataFrame
    SPARK-22319   call loginUserFromKeytab before accessing hdfs
    SPARK-21936   backward compatibility test framework for HiveExternalCatalog
    SPARK-21991   Fix race condition in LauncherServer#acceptConnections
    SPARK-22227   DiskBlockManager.getAllBlocks now tolerates temp files
    SPARK-22332   Fix NaiveBayes unit test occasionly fail (cause by test dataset not deterministic)
    SPARK-21991   Fix java lint
    SPARK-17902   Revive stringsAsFactors option for collect() in SparkR
    SPARK-22328   ClosureCleaner should not miss referenced superclass fields
    SPARK-22355   Dataset.collect is not threadsafe
    SPARK-22356   data source table should support overlapped columns between data and partition schema
    SPARK-19727   Fix for round function that modifies original column
    SPARK-22344   Set java.io.tmpdir for SparkR tests
    SPARK-22291   Conversion error when transforming array types of uuid, inet and cidr to StingType in PostgreSQL
    SPARK-19611   set dataSchema correctly in HiveMetastoreCatalog.convertToLogicalRelation
    SPARK-22333   timeFunctionCall(CURRENT_DATE, CURRENT_TIMESTAMP) has conflicts with columnReference
    MINOR         automatic type inference supports also Date and Timestamp
    SPARK-22306   alter table schema should not erase the bucketing metadata at hive side
    SPARK-22211   Remove incorrect FOJ limit pushdown
    SPARK-22429   Streaming checkpointing code does not retry after failure
    SPARK-22315   Warn if SparkR package version doesn't match SparkContext
    SPARK-22417   Fix for createDataFrame from pandas.DataFrame with timestamp
    SPARK-22327   check for version warning
    SPARK-22281   Handle R method breaking signature changes
    SPARK-22417   Fix for createDataFrame from pandas.DataFrame with timestamp
    SPARK-22403   Add optional checkpointLocation argument to StructuredKafkaWordCount example
    SPARK-22287   SPARK_DAEMON_MEMORY not honored by MesosClusterD…
    SPARK-22472   add null check for top-level primitive values
    SPARK-22344   clean up install dir if running test as source package
    SPARK-22243   spark.yarn.jars should reload from config when checkpoint recovery
    SPARK-22294   Reset spark.driver.bindAddress when starting a Checkpoint
    SPARK-22284   Fix 64KB JVM bytecode limit problem in calculating hash for nested structs
    SPARK-19644   Clean up Scala reflection garbage after creating Encoder (branch-2.2)
    SPARK-21667   ConsoleSink should not fail streaming query with checkpointLocation option
    SPARK-19606   Support constraints in spark-dispatcher
    SPARK-21720   Fix 64KB JVM bytecode limit problem with AND or OR
    SPARK-22488   Fix the view resolution issue in the SparkSession internal table() API
    SPARK-22464   No pushdown for Hive metastore partition predicates containing null-safe equality
    SPARK-19606   fix mesos break
    SPARK-21694   Reduce max iterations in Linear SVM test in R to speed up AppVeyor build
    SPARK-22442   ScalaReflection should produce correct field names for special characters
    SPARK-22442   ScalaReflection should produce correct field names for special characters
    MINOR         Using bufferedInputStream for dataDeserializeStream
    SPARK-22471   SQLListener consumes much memory causing OutOfMemoryError
    SPARK-22377   Use /usr/sbin/lsof if lsof does not exists in release-build.sh
    SPARK-22511   Update maven central repo address
    SPARK-22490   Add PySpark doc for SparkSession.builder
    SPARK-22469   Accuracy problem in comparison with string and numeric
    SPARK-22479   Exclude credentials from SaveintoDataSourceCommand.simpleString
    SPARK-22499   Fix 64KB JVM bytecode limit problem with least and greatest
    SPARK-22494   Fix 64KB limit exception with Coalesce and AtleastNNonNulls
    SPARK-22501   Fix 64KB JVM bytecode limit problem with in
    SPARK-22535   Sleep before killing the python worker in PythRunner.MonitorThread (branch-2.2)
    SPARK-22540   Ensure HighlyCompressedMapStatus calculates correct avgSize
    SPARK-22538   SQLTransformer should not unpersist possibly cached input dataset
    SPARK-22544   FileStreamSource should use its own hadoop conf to call globPathIfNecessary
    SPARK-22498   Fix 64KB JVM bytecode limit problem with concat
    SPARK-22549   Fix 64KB JVM bytecode limit problem with concat_ws
    SPARK-22508   Fix 64KB JVM bytecode limit problem with GenerateUnsafeRowJoiner.create()
    SPARK-22550   Fix 64KB JVM bytecode limit problem with elt
    SPARK-22500   Fix 64KB JVM bytecode limit problem with cast
    SPARK-22548   Incorrect nested AND expression pushed down to JDBC data source

    (Backport from 2.3)
    SPARK-15648 Add TeradataDialect
    SPARK-21376 Fix yarn client token expire issue when cleaning the staging files in long running scenario
    SPARK-21377 Make jars specify with --jars/--packages load-able in AM's credential renwer
    SPARK-21475 Use NIO's Files API to replace FileInputStream/FileOutputStream in some critical paths
    SPARK-21738 Thriftserver doesn't cancel jobs when session is closed
    SPARK-20981 Add new configuration spark.jars.repositories as equivalence of --repositories
    SPARK-20079 Fix client AM not allocating executors after restart
    SPARK-13656 Delete spark.sql.parquet.cacheMetadata from SQLConf and docs
    SPARK-18061 Support spnego for ThriftServer thrift/http auth
    SPARK-21247 Type comparison should respect case-sensitive SQL conf
    SPARK-22188 Adding security headers for preventing XSS, MitM and MIME sniffing
    SPARK-21807 Override ++ operation in ExpressionSet to reduce clone time
    SPARK-17321 Avoid writing shuffle metadata to disk if NM recovery is disabled

    (Jira in Apache Spark is IN PROGRESS)
    BUG-88428 SPARK-21549 Spark fails to complete job correctly in case of OutputFormat which do not write into hdfs
  SPARK-19726   Faild to insert null timestamp value to mysql using spark jdbc
